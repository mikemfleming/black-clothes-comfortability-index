<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Black Clothing Comfortability Index</title>
  <meta name="description" content="Black Clothing Comfortability Index">
  <meta name="author" content="Darkest Before Dawn">

  <link rel="stylesheet" href="css/styles.css?v=1.0">
  <style>
    body {
      color: white;
      background-color: black;
      margin: 0;
    }

    header {
      margin-top: 5rem;
    }

    pre {
      padding: 5px;
      border: 1px solid white;
      min-height: 315px;
    }

    .message {
      margin: 0 auto;
      max-width: 600px;
    }

    .center {
      text-align: center;
    }

    #index {
      border-bottom: 2px solid white;
      min-width: 28px;
    }
  </style>
</head>

<body>
  <header>
    <h1 class="center">The Black Clothing Comfortability Index</h1>
  </header>

  <section class="message">
    <article>
      <h2 id="index-title" class="loading">
        The index for today is <span id="index"></span>
      </h2>
    </article>
    <hr>
    <article>
      <p>
          Below is the response data from the Dark Sky API.
          I'm thinking that the index is a function of the
          UV index and the temperature but, as you can see,
          there is a lot of other data we could base it on.
      </p>
      <pre id="dark-sky-response"></pre>
    </article>
  </section>
  
  <script>
  (function () {
    var host = 'https://ba9wnfs0b3.execute-api.us-east-1.amazonaws.com/dev';
    // const host = 'http://localhost:3000';


    const app = document.getElementById('dark-sky-response');
    const indexContainer = document.getElementById('index');
    const indexTitle = document.getElementById('index-title');

    getLocation()
      .then(({ latitude, longitude }) => {
        fetch(`${host}/weather?lat=${latitude}&lng=${longitude}`)
          .then(res => res.json())
          .then(({ currentConditions, index: { rating, score } }) => {
            indexTitle.classList.remove('loading');
            indexContainer.innerHTML = rating;
            app.innerHTML = JSON.stringify({ score, currentConditions }, null, 4);
          });
      });

    // TODO: handle errors here
    function getLocation() {
      return new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(
          ({ coords }) => resolve(coords)
        );
      });
    }
  })();
  </script>
</body>
</html>